<script>
    window.Caribouflex = window.Caribouflex || {};
    Caribouflex.Stepper = Caribouflex.Stepper || {};

    /**
     * @polymerMixin
     */
    Caribouflex.Stepper.StepPropertyMixin = function (superClass) {
        return class extends superClass {
            static get properties() {
                return {

                    /**
                     * Property used to indicate if the step is saved.
                     * True if it's saved, false otherwise.
                     */
                    save: {
                        type: Boolean,
                        value: false
                    },


                    /**
                     * Property used to indicate if the step is editable.
                     * True if it's editable, false otherwise.
                     */
                    editable: {
                        type: Boolean,
                        value: false
                    },


                    /**
                     * Property used to indicate if the step is optional.
                     * True if it's optional, false otherwise.
                     */
                    optional: {
                        type: Boolean,
                        value: false
                    },


                    /**
                     * Property used to indicate if the step is active.
                     * If the step is active that means it will be open, and it's the current step we are focused on.
                     * True if it's active, false otherwise.
                     */
                    active: {
                        type: Boolean,
                        value: false,
                        reflectToAttribute: true
                    },

                    /**
                     * The continue button text value
                     * 'Continue' by default
                     */
                    continueLabel: {
                        type: String,
                        value: "Continue"
                    },

                    /**
                     * The finish button text value
                     * 'Finish' by default
                     */
                    finishLabel: {
                        type: String,
                        value: "Finish"
                    },

                    /**
                     * The update button text value
                     * 'Update' by default
                     */
                    updateLabel: {
                        type: String,
                        value: "Update"
                    },

                    /**
                     * The skip button text value
                     * 'Skip' by default
                     */
                    skipLabel: {
                        type: String,
                        value: "Skip"
                    },

                    /**
                     * True to display the skip button, false otherwise.
                     * If the step is linear, the skip button will do nothing, except if the property Optional is true.
                     */
                    skipButton: {
                        type: Boolean,
                        value: false
                    }
                }
            }

            /**
             * This function is used to set the property save to true.
             */
            saveStep() {
                this.setAttribute("save", true);
            }

            /**
             * This function is used to open the step following this step.
             * If all the step are saved and no step left, an event 'last-step-closed' will be fired.
             */
            openNextStep() {
                if (this.nextElementSibling !== undefined && this.nextElementSibling !== null && !this.nextElementSibling
                    .save) {
                    // We toggle the step. As parameter we set if it's the last step or not
                    // for the button.
                    this.nextElementSibling.toggleStep(this.parentElement.isLastStep());

                } else if (this.nextElementSibling !== undefined && this.nextElementSibling !== null)
                    this.nextElementSibling.openNextStep();
                else
                    this.dispatchEvent(new CustomEvent('last-step-closed', {
                        bubbles: true,
                        composed: true
                    }));
            }

            /**
             * Getter used to know if the step is active or not.
             * @return {Boolean} True if it is, false otherwise.
             */
            isActive() {
                return this.active;
            }

            /**
             * This function is used to register an element to the parent.
             * @private
             */
            _register() {
                this.parentElement._registerStep(this);
            }

            /**
             * This function is used to know if the property 'openFirstStepOnStartup' is set to true.
             * @private
             */ 
            _getOpenFirstStepOnStartup() {
                return this.parentElement.openFirstStepOnStartup;
            }

        }
    }
</script>